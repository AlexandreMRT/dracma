<% content_for(:title) { "#{@portfolio.name} — Dracma" } %>

<div class="space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold"><%= @portfolio.name %></h1>
      <p class="text-gray-400 text-sm">
        <%= @portfolio.is_default ? "Default portfolio" : "" %>
      </p>
    </div>
    <div class="flex gap-2">
      <%= link_to "Edit", edit_portfolio_path(@portfolio), class: "bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm" %>
      <%= link_to "Transactions", portfolio_transactions_path(@portfolio), class: "bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm" %>
      <%= link_to "← Back", portfolios_path, class: "text-gray-400 hover:text-white text-sm" %>
    </div>
  </div>

  <%# Performance summary %>
  <% perf = @performance %>
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
      <p class="text-gray-400 text-sm">Invested</p>
      <p class="text-xl font-bold text-white">R$ <%= sprintf("%.2f", perf[:total_invested]) %></p>
    </div>
    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
      <p class="text-gray-400 text-sm">Current Value</p>
      <p class="text-xl font-bold text-white">R$ <%= sprintf("%.2f", perf[:total_current_value]) %></p>
    </div>
    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
      <p class="text-gray-400 text-sm">P&L</p>
      <p class="text-xl font-bold <%= perf[:total_profit_loss] >= 0 ? 'text-emerald-400' : 'text-red-400' %>">
        R$ <%= sprintf("%+.2f", perf[:total_profit_loss]) %> (<%= sprintf("%+.1f%%", perf[:total_profit_loss_pct]) %>)
      </p>
    </div>
    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
      <p class="text-gray-400 text-sm">Dividends</p>
      <p class="text-xl font-bold text-emerald-400">R$ <%= sprintf("%.2f", perf[:dividend_income]) %></p>
    </div>
  </div>

  <%# Positions table %>
  <% if perf[:positions].any? %>
    <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="text-gray-400 text-left">
            <th class="px-4 py-2">Ticker</th>
            <th class="px-4 py-2 text-right">Qty</th>
            <th class="px-4 py-2 text-right">Avg Price</th>
            <th class="px-4 py-2 text-right">Current</th>
            <th class="px-4 py-2 text-right">Invested</th>
            <th class="px-4 py-2 text-right">Value</th>
            <th class="px-4 py-2 text-right">P&L</th>
          </tr>
        </thead>
        <tbody>
          <% perf[:positions].sort_by { |p| -(p[:current_value] || 0) }.each do |pos| %>
            <tr class="border-t border-gray-700">
              <td class="px-4 py-2 font-mono text-emerald-400"><%= pos[:ticker] %></td>
              <td class="px-4 py-2 text-right text-white"><%= sprintf("%.2f", pos[:quantity]) %></td>
              <td class="px-4 py-2 text-right text-gray-300">R$ <%= sprintf("%.2f", pos[:avg_price]) %></td>
              <td class="px-4 py-2 text-right text-gray-300">R$ <%= sprintf("%.2f", pos[:current_price]) %></td>
              <td class="px-4 py-2 text-right text-gray-300">R$ <%= sprintf("%.2f", pos[:invested_value]) %></td>
              <td class="px-4 py-2 text-right text-white">R$ <%= sprintf("%.2f", pos[:current_value]) %></td>
              <td class="px-4 py-2 text-right <%= pos[:profit_loss] >= 0 ? 'text-emerald-400' : 'text-red-400' %>">
                <%= sprintf("%+.2f%%", pos[:profit_loss_pct]) %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="bg-gray-800 rounded-lg p-8 border border-gray-700 text-center text-gray-400">
      No positions yet. Add transactions to build your portfolio.
    </div>
  <% end %>
</div>
